<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Main function for model estimation — sampler • rewind</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Main function for model estimation — sampler" />
<meta property="og:description" content="Estimating restricted latent class models (RLCM) by MCMC sampling
given pre-specified upper bound for (M) latent state dimension. This function performs MCMC sampling
with user-specified options.
NB:
add flexibility to specify other parameters as fixed (or partially
fixed such as the rows of Q).

" />






<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->




  

  

  </head>

  <body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rewind</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.7.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/zhenkewu/rewind/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Main function for model estimation</h1>
    <small class="dont-index">Source: <a href='https://github.com/zhenkewu/rewind/blob/master/R/sample_mcmc.R'><code>R/sample_mcmc.R</code></a></small>
    <div class="hidden name"><code>sampler.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Estimating restricted latent class models (RLCM) by MCMC sampling
given pre-specified upper bound for (M) latent state dimension. This function performs MCMC sampling
with user-specified options.
NB:</p><ol>
<li><p>add flexibility to specify other parameters as fixed (or partially
fixed such as the rows of Q).</p></li>
</ol>

    </div>

    <div class="ref-usage sourceCode"><pre class='sourceCode r'><code><span class='fu'>sampler</span><span class='op'>(</span><span class='va'>dat</span>, <span class='va'>model_options</span>, <span class='va'>mcmc_options</span><span class='op'>)</span></code></pre></div>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>dat</th>
      <td><p>binary data matrix (row for observations and column for dimensions)</p></td>
    </tr>
    <tr>
      <th>model_options</th>
      <td><p>Specifying assumed model options:</p><ul>
<li><p><code>n</code> The number of observations</p></li>
<li><p><code>t_max</code> The maximum (guessed) number of clusters in the data during
the posterior inference</p></li>
<li><p><code>m_max</code> For a model with pre-specified number of states, <code>m_max</code>;
In an infinite dimension model, <code>m_max</code> is
the maximum (guessed) latent state dimension during the posterior inference
(see slice_sampler to come); one can increase this number if
this package recommends so in the printed message;</p></li>
<li><p><code>a_theta, a_psi</code> hyperparameters for true and false positive rates;
<code>a_theta</code> and <code>a_psi</code> are both 2 by L. If provided with these
parameter values, the algorithm does not pool information across measurements.
It assumes independent priors for all true and false positive rates.</p></li>
<li><p><code>pooling_pr</code> Set to <code>TRUE</code> if to pool theta and psi (must NOT
set <code>a_theta</code> or <code>a_psi</code>; must set <code>a0_TPR</code>,
<code>a0_FPR</code>,<code>e0_TPR</code>,<code>f0_TPR</code>,<code>e0_FPR</code>,<code>f0_FPR</code> that are
hyperparameters of the priors for TPR or FPR:</p>
<p><code>theta[1] &lt;--Beta-- a_theta[1:2,l] &lt;--deterministic--
(a0_TPR, hyper_pseudo_n_TPR &lt;--Gamma-- (e0_TPR, f0_TPR))
--deterministic--&gt; a_theta[1:2,l] --Beta--&gt;theta[2]</code>; (a_theta has duplicated
columns, hence an arbitary column index l)</p></li>
<li><p><code>hyper_pseudo_n_TPR</code>,<code>hyper_pseudo_n_FPR</code> pseudo sample
size in <code>Beta(hyper_pseudo_n_TPR*a0_TPR,hyper_pseudo_n_TPR*(1-a0_TPR))</code>;
usually works well by setting this to a large number, say 10 or 50. Each
is assigned a <code>Gamma(e0_XPR, f0_XPR)</code> prior</p></li>
<li><p><code>a0_TPR</code> mean of a Beta prior TPR</p></li>
<li><p><code>a0_FPR</code> mean of a Beta prior FPR</p>
<p>The following four parameters are not needed if <code>hyper_pseudo_n_TPR</code>,<code>hyper_pseudo_n_FPR</code>
are specified.</p></li>
<li><p><code>e0_TPR,f0_TPR</code> the first, second Gamma parameter for the TPR
pseudo sample size hyperparameter: <code>hyper_pseudo_n_TPR</code></p></li>
<li><p><code>e0_FPR,f0_FPR</code> the first, second Gamma parameter for the FPR
pseudo sample size hyperparameter: <code>hyper_pseudo_n_FPR</code></p></li>
<li><p><code>log_v</code> The character string representing the prior
distribution for the number of true clusters, e.g.,
<code>"function(k) {log(0.1) + (k-1)*log(0.9)}"</code>. We pre-computed
log of the coefficients in Mixture of Finite Mixtures
(Miller and Harrison, 2017, JASA). Use this code:
<code>mfm_coefficients(eval(parse(text=model_options0$log_pk)),
model_options0$gamma,
model_options0$n,
model_options0$t_max+1)</code></p></li>
<li><p><code>the_partition</code> Put a vector of z here if not to update
the partition/clustering. The z must be 1) from 1 to t, which is
the number of groups, 2) consecutive from 1 to t.</p></li>
<li><p><code>a_alpha, b_alpha</code> Just for infinite latent state dimension model  -
Gamma hyperparameter for the hyperprior on <code>alpha</code>.
(see slice_sampler to come)</p></li>
</ul><p>The following are not updated if provided with fixed values</p><ul>
<li><p><code>Q</code> Q matrix</p></li>
<li><p><code>theta</code> a vector of true positive rates</p></li>
<li><p><code>psi</code> a vector of false positive rates</p></li>
<li><p><code>p</code> a vector of latent state prevalences</p></li>
<li><p><code>alpha</code> The hyperparameter
for <code>Beta(alpha/m_max,1)</code> (can set to <code>m_max</code>);
For infinite dimension model, the hyperparameter for IBP (can set to 1).</p></li>
</ul></td>
    </tr>
    <tr>
      <th>mcmc_options</th>
      <td><p>Options for MCMC algorithm:</p><ul>
<li><p><code>n_total</code> total number of MCMC iterations</p></li>
<li><p><code>n_keep</code> the number of MCMC samples kept for posterior inference.</p></li>
<li><p><code>n_burnin</code> the number of burnin iterations to be discarded
for drawing the posterior inference.</p></li>
<li><p><code>n_split</code> the number of restricted Gibbs scan to arrive at a launch state;
see <code><a href='split_merge.html'>split_merge</a></code> and <code><a href='restricted_gibbs.html'>restricted_gibbs</a></code></p></li>
<li><p><code>print_mod</code> print intermediate model fitting information</p></li>
<li><p><code>constrained</code> update the Q matrix with identifiability constraints (if <code>TRUE</code>);
otherwise, set to <code>FALSE</code>.</p></li>
<li><p><code>block_update_H</code> update rows of H (if <code>TRUE</code>) or not
(if <code>NULL</code> or <code>FALSE</code> - must be so for slice_sampler to come).</p></li>
<li><p><code>block_update_Q</code> update columns of Q (if <code>TRUE</code>) or not
(if <code>NULL</code> or <code>FALSE</code> - must be so for slice_sampler to come).
Then no identifiability constraint is imposed upon Q at any iterations.</p></li>
<li><p><code>ALL_IN_ONE_START</code> <code>TRUE</code> for putting all subjects in one cluster,
<code>FALSE</code> by starting from a hierarchical agglomerative clustering (complete linkage) and cut
to produce <code>floor(t_max/4)</code> clusters. Consider this as a warm start.</p></li>
<li><p><code>MORE_SPLIT</code> when getting to launch state of the partition,
<code>TRUE</code> For biasing towards split when reaching a random launch state;
<code>FALSE</code> for choosing a pair (i,j) uniformly and then merge (if they belong to distinct clusters)
or split (if they belong to the identical cluster).</p></li>
</ul></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>posterior samples for quantities of interest.
It is a list comprised of the following elements:</p><ul>
<li><p><code>t_samp</code></p></li>
<li><p><code>z_samp</code></p></li>
<li><p><code>N_samp</code></p></li>
<li><p><code>keepers</code> indices of MCMC samples kept for inference; will be used
to see which ones to use for inference after <code>n_burnin</code>.</p></li>
<li><p><code>H_star_samp</code> <code>t_max+3</code> by <code>m_max</code> binary matrix</p></li>
<li><p><code>alpha_samp</code></p></li>
</ul><p>The following are recorded if they are not fixed in a priori:</p><ul>
<li><p><code>Q_samp</code></p></li>
<li><p><code>theta_samp</code></p></li>
<li><p><code>psi_samp</code></p></li>
<li><p><code>p_samp</code></p></li>
</ul>


    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <div class="ref-examples sourceCode"><pre class='sourceCode r'><code><span class='r-in'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/base/rm.html'>rm</a></span><span class='op'>(</span>list<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/ls.html'>ls</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/zhenkewu/rewind'>rewind</a></span><span class='op'>)</span></span>
<span class='r-in'>  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/HenrikBengtsson/matrixStats'>matrixStats</a></span><span class='op'>)</span></span>
<span class='r-in'>  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>ars</span><span class='op'>)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='co'>#optional packages:</span></span>
<span class='r-in'>  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>mcclust.ext</span><span class='op'>)</span> <span class='co'># http://wrap.warwick.ac.uk/71934/1/mcclust.ext_1.0.tar.gz</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='co'># color palette for heatmaps:</span></span>
<span class='r-in'>  <span class='va'>YlGnBu5</span>   <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'#ffffd9'</span>,<span class='st'>'#c7e9b4'</span>,<span class='st'>'#41b6c4'</span>,<span class='st'>'#225ea8'</span>,<span class='st'>'#081d58'</span>,<span class='st'>"#092d94"</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='va'>hmcols</span>    <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/grDevices/colorRamp.html'>colorRampPalette</a></span><span class='op'>(</span><span class='va'>YlGnBu5</span><span class='op'>)</span><span class='op'>(</span><span class='fl'>256</span><span class='op'>)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='co'># simulate data:</span></span>
<span class='r-in'>  <span class='va'>L0</span> <span class='op'>&lt;-</span> <span class='fl'>100</span></span>
<span class='r-in'>  <span class='va'>options_sim0</span>  <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>N <span class='op'>=</span> <span class='fl'>200</span>,  <span class='co'># sample size.</span></span>
<span class='r-in'>                        M <span class='op'>=</span> <span class='fl'>3</span>,    <span class='co'># true number of machines.</span></span>
<span class='r-in'>                        L <span class='op'>=</span> <span class='va'>L0</span>,   <span class='co'># number of antibody landmarks.</span></span>
<span class='r-in'>                        K <span class='op'>=</span> <span class='fl'>8</span>,    <span class='co'># number of true components.</span></span>
<span class='r-in'>                        theta <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>0.9</span>,<span class='va'>L0</span><span class='op'>)</span>, <span class='co'># true positive rates.</span></span>
<span class='r-in'>                        psi   <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>0.1</span>,<span class='va'>L0</span><span class='op'>)</span>, <span class='co'># false positive rates.</span></span>
<span class='r-in'>                        alpha1 <span class='op'>=</span> <span class='fl'>1</span>, <span class='co'># half of the people have the first machine.</span></span>
<span class='r-in'>                        frac <span class='op'>=</span> <span class='fl'>0.2</span>, <span class='co'># fraction of positive dimensions (L-2M) in Q.</span></span>
<span class='r-in'>                        <span class='co'>#pop_frac = rep(1/K0,K0) # population prevalences.</span></span>
<span class='r-in'>                        pop_frac <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>2</span>,<span class='fl'>4</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>4</span><span class='op'>)</span><span class='op'>)</span> <span class='co'># population prevalences.</span></span>
<span class='r-in'>  <span class='op'>)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/graphics/image.html'>image</a></span><span class='op'>(</span><span class='fu'><a href='simulate_data.html'>simulate_data</a></span><span class='op'>(</span><span class='va'>options_sim0</span>,SETSEED <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>$</span><span class='va'>datmat</span>,col<span class='op'>=</span><span class='va'>hmcols</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='va'>simu</span>     <span class='op'>&lt;-</span> <span class='fu'><a href='simulate_data.html'>simulate_data</a></span><span class='op'>(</span><span class='va'>options_sim0</span>, SETSEED<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='va'>simu_dat</span> <span class='op'>&lt;-</span> <span class='va'>simu</span><span class='op'>$</span><span class='va'>datmat</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/base/rle.html'>rle</a></span><span class='op'>(</span><span class='va'>simu</span><span class='op'>$</span><span class='va'>Z</span><span class='op'>)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='co'>#</span></span>
<span class='r-in'>  <span class='co'># visualize truth:</span></span>
<span class='r-in'>  <span class='co'>#</span></span>
<span class='r-in'>  <span class='co'># plot_truth(simu,options_sim0)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='co'>#</span></span>
<span class='r-in'>  <span class='co'># specifying options:</span></span>
<span class='r-in'>  <span class='co'>#</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='co'># model options:</span></span>
<span class='r-in'>  <span class='va'>m_max0</span> <span class='op'>&lt;-</span> <span class='fl'>5</span></span>
<span class='r-in'>  <span class='va'>model_options0</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span></span>
<span class='r-in'>    n   <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>simu_dat</span><span class='op'>)</span>,</span>
<span class='r-in'>    t_max  <span class='op'>=</span> <span class='fl'>40</span>,</span>
<span class='r-in'>    m_max  <span class='op'>=</span> <span class='va'>m_max0</span>,</span>
<span class='r-in'>    b  <span class='op'>=</span> <span class='fl'>1</span>, <span class='co'># Dirichlet hyperparameter; in the functions above,</span></span>
<span class='r-in'>    <span class='co'># we used "b" - also can be called "gamma"!.</span></span>
<span class='r-in'>    <span class='co'>#Q  = simu$Q,</span></span>
<span class='r-in'>    a_theta <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>replicate</a></span><span class='op'>(</span><span class='va'>L0</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>9</span>,<span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span class='r-in'>    a_psi   <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>replicate</a></span><span class='op'>(</span><span class='va'>L0</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>9</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span class='r-in'>    <span class='co'>#theta = options_sim0$theta,</span></span>
<span class='r-in'>    <span class='co'>#psi   = options_sim0$psi,</span></span>
<span class='r-in'>    alpha   <span class='op'>=</span> <span class='fl'>0.1</span>,</span>
<span class='r-in'>    frac <span class='op'>=</span> <span class='fl'>0.2</span>,</span>
<span class='r-in'>    <span class='co'>#p_both      = rep(0.5,3),#,c(0.5,0.5^2,0.5^3,0.5^4,0.5^5)</span></span>
<span class='r-in'>    <span class='co'>#p0 = rep(0.5,m_max0), # &lt;--- this seems to make a difference in convergence.</span></span>
<span class='r-in'>    log_pk <span class='op'>=</span> <span class='st'>"function(k) {log(0.1) + (k-1)*log(0.9)}"</span><span class='co'># Geometric(0.1).</span></span>
<span class='r-in'>    <span class='co'>#Prior for the number of components.</span></span>
<span class='r-in'>  <span class='op'>)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='co'># pre-compute the log of coefficients in MFM:</span></span>
<span class='r-in'>  <span class='va'>model_options0</span><span class='op'>$</span><span class='va'>log_v</span><span class='op'>&lt;-</span><span class='fu'><a href='mfm_coefficients.html'>mfm_coefficients</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/eval.html'>eval</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/parse.html'>parse</a></span><span class='op'>(</span>text<span class='op'>=</span><span class='va'>model_options0</span><span class='op'>$</span><span class='va'>log_pk</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span class='r-in'>                                         <span class='va'>model_options0</span><span class='op'>$</span><span class='va'>b</span>,</span>
<span class='r-in'>                                         <span class='va'>model_options0</span><span class='op'>$</span><span class='va'>n</span>,</span>
<span class='r-in'>                                         <span class='va'>model_options0</span><span class='op'>$</span><span class='va'>t_max</span><span class='op'>+</span><span class='fl'>1</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='co'># mcmc options:</span></span>
<span class='r-in'>  <span class='va'>mcmc_options0</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span></span>
<span class='r-in'>    n_total <span class='op'>=</span> <span class='fl'>200</span>,</span>
<span class='r-in'>    n_keep  <span class='op'>=</span> <span class='fl'>50</span>,</span>
<span class='r-in'>    n_split <span class='op'>=</span> <span class='fl'>5</span>,</span>
<span class='r-in'>    print_mod <span class='op'>=</span> <span class='fl'>10</span>,</span>
<span class='r-in'>    constrained <span class='op'>=</span> <span class='cn'>TRUE</span>, <span class='co'># &lt;-- need to write a manual about when these options are okay.</span></span>
<span class='r-in'>    block_update_H <span class='op'>=</span> <span class='cn'>TRUE</span>,</span>
<span class='r-in'>    block_update_Q <span class='op'>=</span> <span class='op'>!</span><span class='cn'>TRUE</span>,</span>
<span class='r-in'>    ALL_IN_ONE_START <span class='op'>=</span><span class='op'>!</span><span class='cn'>TRUE</span>,  <span class='co'># &lt;--- TRUE for putting all subjects in one cluster,</span></span>
<span class='r-in'>    <span class='co'># FALSE by starting from a hierechical clustering</span></span>
<span class='r-in'>    <span class='co'># (complete linkage) and cut</span></span>
<span class='r-in'>    <span class='co'># to produce floor(t_max/4). Consider this as a warm start.</span></span>
<span class='r-in'>    MORE_SPLIT <span class='op'>=</span> <span class='cn'>TRUE</span>,</span>
<span class='r-in'>    print_Q    <span class='op'>=</span> <span class='cn'>TRUE</span>,</span>
<span class='r-in'>    init_frac  <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.51</span>,<span class='fl'>0.99</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='op'>)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='co'># run posterior algorithm for simulated data:</span></span>
<span class='r-in'>  <span class='va'>out</span> <span class='op'>&lt;-</span> <span class='fu'>sampler</span><span class='op'>(</span><span class='va'>simu_dat</span>,<span class='va'>model_options0</span>,<span class='va'>mcmc_options0</span><span class='op'>)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='co'>###############################################################</span></span>
<span class='r-in'>  <span class='co'>## Posterior summaries:</span></span>
<span class='r-in'>  <span class='co'>###############################################################</span></span>
<span class='r-in'>  <span class='va'>out0</span> <span class='op'>&lt;-</span> <span class='va'>out</span></span>
<span class='r-in'>  <span class='va'>out</span> <span class='op'>&lt;-</span> <span class='fu'><a href='postprocess_H_Q.html'>postprocess_H_Q</a></span><span class='op'>(</span><span class='va'>out0</span><span class='op'>)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='co'>#Z_SAMP_FOR_PLOT &lt;- out$z_samp  # &lt;---- use pseudo-indicators for co-clustering.</span></span>
<span class='r-in'>  <span class='co'># tend to be more granular.</span></span>
<span class='r-in'>  <span class='va'>Z_SAMP_FOR_PLOT</span> <span class='op'>&lt;-</span> <span class='va'>out</span><span class='op'>$</span><span class='va'>z_sci_samp</span> <span class='co'># &lt;--- use scientific-cluster indicators.</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='co'># posterior co-clustering probabilities (N by N):</span></span>
<span class='r-in'>  <span class='va'>comat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='z2comat.html'>z2comat</a></span><span class='op'>(</span><span class='va'>Z_SAMP_FOR_PLOT</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/graphics/image.html'>image</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='va'>options_sim0</span><span class='op'>$</span><span class='va'>N</span>,<span class='fl'>1</span><span class='op'>:</span><span class='va'>options_sim0</span><span class='op'>$</span><span class='va'>N</span>, <span class='va'>comat</span>,</span>
<span class='r-in'>        xlab<span class='op'>=</span><span class='st'>"Subjects"</span>,ylab<span class='op'>=</span><span class='st'>"Subjects"</span>,col<span class='op'>=</span><span class='va'>hmcols</span>,main<span class='op'>=</span><span class='st'>"co-clustering"</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='kw'>for</span> <span class='op'>(</span><span class='va'>k</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='va'>options_sim0</span><span class='op'>$</span><span class='va'>K</span><span class='op'>)</span><span class='op'>{</span></span>
<span class='r-in'>    <span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>h<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rle.html'>rle</a></span><span class='op'>(</span><span class='va'>simu</span><span class='op'>$</span><span class='va'>Z</span><span class='op'>)</span><span class='op'>$</span><span class='va'>lengths</span><span class='op'>)</span><span class='op'>[</span><span class='va'>k</span><span class='op'>]</span><span class='op'>+</span><span class='fl'>0.5</span>,lty<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span></span>
<span class='r-in'>    <span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>v<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rle.html'>rle</a></span><span class='op'>(</span><span class='va'>simu</span><span class='op'>$</span><span class='va'>Z</span><span class='op'>)</span><span class='op'>$</span><span class='va'>lengths</span><span class='op'>)</span><span class='op'>[</span><span class='va'>k</span><span class='op'>]</span><span class='op'>+</span><span class='fl'>0.5</span>,lty<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='op'>}</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='co'># Summarize partition C:</span></span>
<span class='r-in'>  <span class='co'>## Approach 0: The maximum a posterior: issue - the space is huge (Bell number).</span></span>
<span class='r-in'>  <span class='co'>##             Not implemented.</span></span>
<span class='r-in'>  <span class='co'>## Approach 1: Minimizing the least squared error between the co-clustering indicators</span></span>
<span class='r-in'>  <span class='co'>##            and the posterior co-clustering probabilities; (Dahl 2006)</span></span>
<span class='r-in'>  <span class='co'>## Approach 2: Wade - estimate the best partition using posterior expected loss</span></span>
<span class='r-in'>  <span class='co'>##             by variation of information (VI) metric.</span></span>
<span class='r-in'>  <span class='va'>nsamp_C</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span><span class='op'>(</span><span class='va'>Z_SAMP_FOR_PLOT</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span></span>
<span class='r-in'>  <span class='va'>z_Em</span>    <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='cn'>NA</span>,<span class='va'>nsamp_C</span><span class='op'>)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span>mfrow<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>,<span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='co'>## Approach 1:</span></span>
<span class='r-in'>  <span class='kw'>for</span> <span class='op'>(</span><span class='va'>iter</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='va'>nsamp_C</span><span class='op'>)</span><span class='op'>{</span></span>
<span class='r-in'>    <span class='va'>z_Em</span><span class='op'>[</span><span class='va'>iter</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/norm.html'>norm</a></span><span class='op'>(</span><span class='fu'><a href='z2comat.html'>z2comat</a></span><span class='op'>(</span><span class='va'>Z_SAMP_FOR_PLOT</span><span class='op'>[</span>,<span class='va'>iter</span>,drop<span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>]</span><span class='op'>)</span><span class='op'>-</span><span class='va'>comat</span>,<span class='st'>"F"</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='op'>}</span></span>
<span class='r-in'>  <span class='va'>ind_dahl</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.min</a></span><span class='op'>(</span><span class='va'>z_Em</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='co'># plot 1:</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/graphics/image.html'>image</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='va'>options_sim0</span><span class='op'>$</span><span class='va'>N</span>,<span class='fl'>1</span><span class='op'>:</span><span class='va'>options_sim0</span><span class='op'>$</span><span class='va'>N</span>,</span>
<span class='r-in'>        <span class='fu'><a href='z2comat.html'>z2comat</a></span><span class='op'>(</span><span class='va'>Z_SAMP_FOR_PLOT</span><span class='op'>[</span>,<span class='va'>ind_dahl</span>,drop<span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>]</span><span class='op'>)</span>,col<span class='op'>=</span><span class='va'>hmcols</span>,</span>
<span class='r-in'>        main<span class='op'>=</span><span class='st'>"Dahl (2006) - least squares to hat{pi}_ij"</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='kw'>for</span> <span class='op'>(</span><span class='va'>k</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='va'>options_sim0</span><span class='op'>$</span><span class='va'>K</span><span class='op'>)</span><span class='op'>{</span></span>
<span class='r-in'>    <span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>h<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rle.html'>rle</a></span><span class='op'>(</span><span class='va'>simu</span><span class='op'>$</span><span class='va'>Z</span><span class='op'>)</span><span class='op'>$</span><span class='va'>lengths</span><span class='op'>)</span><span class='op'>[</span><span class='va'>k</span><span class='op'>]</span><span class='op'>+</span><span class='fl'>0.5</span>,lty<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span></span>
<span class='r-in'>    <span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>v<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rle.html'>rle</a></span><span class='op'>(</span><span class='va'>simu</span><span class='op'>$</span><span class='va'>Z</span><span class='op'>)</span><span class='op'>$</span><span class='va'>lengths</span><span class='op'>)</span><span class='op'>[</span><span class='va'>k</span><span class='op'>]</span><span class='op'>+</span><span class='fl'>0.5</span>,lty<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='op'>}</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='co'>## Approach 2 - use "mcclust.ext" pacakge:</span></span>
<span class='r-in'>  <span class='co'># process the posterior samples of cluster indicators:</span></span>
<span class='r-in'>  <span class='va'>psm</span>    <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/mcclust/man/comp.psm.html'>comp.psm</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='va'>Z_SAMP_FOR_PLOT</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='co'># point estimate using all methods:</span></span>
<span class='r-in'>  <span class='va'>bmf.VI</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/mcclust.ext/man/minVI.html'>minVI</a></span><span class='op'>(</span><span class='va'>psm</span>,<span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='va'>Z_SAMP_FOR_PLOT</span><span class='op'>)</span>,method<span class='op'>=</span><span class='st'>"all"</span>,include.greedy<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>bmf.VI</span><span class='op'>)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='co'># plot 2:</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/graphics/image.html'>image</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='va'>options_sim0</span><span class='op'>$</span><span class='va'>N</span>,<span class='fl'>1</span><span class='op'>:</span><span class='va'>options_sim0</span><span class='op'>$</span><span class='va'>N</span>,</span>
<span class='r-in'>        <span class='fu'><a href='z2comat.html'>z2comat</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='va'>bmf.VI</span><span class='op'>$</span><span class='va'>cl</span><span class='op'>[</span><span class='st'>"avg"</span>,<span class='op'>]</span>,ncol<span class='op'>=</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>,col<span class='op'>=</span><span class='va'>hmcols</span>,</span>
<span class='r-in'>        main<span class='op'>=</span><span class='st'>"Wade clustering"</span><span class='op'>)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='kw'>for</span> <span class='op'>(</span><span class='va'>k</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='va'>options_sim0</span><span class='op'>$</span><span class='va'>K</span><span class='op'>)</span><span class='op'>{</span></span>
<span class='r-in'>    <span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>h<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rle.html'>rle</a></span><span class='op'>(</span><span class='va'>simu</span><span class='op'>$</span><span class='va'>Z</span><span class='op'>)</span><span class='op'>$</span><span class='va'>lengths</span><span class='op'>)</span><span class='op'>[</span><span class='va'>k</span><span class='op'>]</span><span class='op'>+</span><span class='fl'>0.5</span>,lty<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span></span>
<span class='r-in'>    <span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>v<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rle.html'>rle</a></span><span class='op'>(</span><span class='va'>simu</span><span class='op'>$</span><span class='va'>Z</span><span class='op'>)</span><span class='op'>$</span><span class='va'>lengths</span><span class='op'>)</span><span class='op'>[</span><span class='va'>k</span><span class='op'>]</span><span class='op'>+</span><span class='fl'>0.5</span>,lty<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='op'>}</span></span>
<span class='r-in'>  <span class='co'>#heatmap(z2comat(bmf.VI$cl["avg",]),col=hmcols)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='co'># credible sets as defined in Wade and Ghahramani 2017.</span></span>
<span class='r-in'>  <span class='va'>bmf.cb</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/mcclust.ext/man/credibleball.html'>credibleball</a></span><span class='op'>(</span><span class='va'>bmf.VI</span><span class='op'>$</span><span class='va'>cl</span><span class='op'>[</span><span class='fl'>1</span>,<span class='op'>]</span>,<span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='va'>Z_SAMP_FOR_PLOT</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='co'># plot 3:</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/graphics/image.html'>image</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='va'>options_sim0</span><span class='op'>$</span><span class='va'>N</span>,<span class='fl'>1</span><span class='op'>:</span><span class='va'>options_sim0</span><span class='op'>$</span><span class='va'>N</span>,</span>
<span class='r-in'>        <span class='fu'><a href='z2comat.html'>z2comat</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='va'>bmf.cb</span><span class='op'>$</span><span class='va'>c.horiz</span><span class='op'>[</span><span class='fl'>1</span>,<span class='op'>]</span>,ncol<span class='op'>=</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>,col<span class='op'>=</span><span class='va'>hmcols</span>,</span>
<span class='r-in'>        main<span class='op'>=</span><span class='st'>"Wade credible ball - horizontal"</span><span class='op'>)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='kw'>for</span> <span class='op'>(</span><span class='va'>k</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='va'>options_sim0</span><span class='op'>$</span><span class='va'>K</span><span class='op'>)</span><span class='op'>{</span></span>
<span class='r-in'>    <span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>h<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rle.html'>rle</a></span><span class='op'>(</span><span class='va'>simu</span><span class='op'>$</span><span class='va'>Z</span><span class='op'>)</span><span class='op'>$</span><span class='va'>lengths</span><span class='op'>)</span><span class='op'>[</span><span class='va'>k</span><span class='op'>]</span><span class='op'>+</span><span class='fl'>0.5</span>,lty<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span></span>
<span class='r-in'>    <span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>v<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rle.html'>rle</a></span><span class='op'>(</span><span class='va'>simu</span><span class='op'>$</span><span class='va'>Z</span><span class='op'>)</span><span class='op'>$</span><span class='va'>lengths</span><span class='op'>)</span><span class='op'>[</span><span class='va'>k</span><span class='op'>]</span><span class='op'>+</span><span class='fl'>0.5</span>,lty<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='op'>}</span></span>
<span class='r-in'>  <span class='co'>#heatmap(z2comat(bmf.cb$c.horiz),col=hmcols)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='co'># plot 4:</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/graphics/image.html'>image</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='va'>options_sim0</span><span class='op'>$</span><span class='va'>N</span>,<span class='fl'>1</span><span class='op'>:</span><span class='va'>options_sim0</span><span class='op'>$</span><span class='va'>N</span>,</span>
<span class='r-in'>        <span class='fu'><a href='z2comat.html'>z2comat</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='va'>bmf.cb</span><span class='op'>$</span><span class='va'>c.uppervert</span><span class='op'>[</span><span class='fl'>1</span>,<span class='op'>]</span>,ncol<span class='op'>=</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>,col<span class='op'>=</span><span class='va'>hmcols</span>,</span>
<span class='r-in'>        main<span class='op'>=</span><span class='st'>"Wade credible ball - upper vertical"</span><span class='op'>)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='kw'>for</span> <span class='op'>(</span><span class='va'>k</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='va'>options_sim0</span><span class='op'>$</span><span class='va'>K</span><span class='op'>)</span><span class='op'>{</span></span>
<span class='r-in'>    <span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>h<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rle.html'>rle</a></span><span class='op'>(</span><span class='va'>simu</span><span class='op'>$</span><span class='va'>Z</span><span class='op'>)</span><span class='op'>$</span><span class='va'>lengths</span><span class='op'>)</span><span class='op'>[</span><span class='va'>k</span><span class='op'>]</span><span class='op'>+</span><span class='fl'>0.5</span>,lty<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span></span>
<span class='r-in'>    <span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>v<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rle.html'>rle</a></span><span class='op'>(</span><span class='va'>simu</span><span class='op'>$</span><span class='va'>Z</span><span class='op'>)</span><span class='op'>$</span><span class='va'>lengths</span><span class='op'>)</span><span class='op'>[</span><span class='va'>k</span><span class='op'>]</span><span class='op'>+</span><span class='fl'>0.5</span>,lty<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='op'>}</span></span>
<span class='r-in'>  <span class='co'>#heatmap(z2comat(bmf.cb$c.uppervert),col=hmcols)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='co'># plot 5:</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/graphics/image.html'>image</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='va'>options_sim0</span><span class='op'>$</span><span class='va'>N</span>,<span class='fl'>1</span><span class='op'>:</span><span class='va'>options_sim0</span><span class='op'>$</span><span class='va'>N</span>,</span>
<span class='r-in'>        <span class='fu'><a href='z2comat.html'>z2comat</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='va'>bmf.cb</span><span class='op'>$</span><span class='va'>c.lowervert</span>,ncol<span class='op'>=</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span>,col<span class='op'>=</span><span class='va'>hmcols</span>,</span>
<span class='r-in'>        main<span class='op'>=</span><span class='st'>"Wade credible ball - lower vertical"</span><span class='op'>)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='kw'>for</span> <span class='op'>(</span><span class='va'>k</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='va'>options_sim0</span><span class='op'>$</span><span class='va'>K</span><span class='op'>)</span><span class='op'>{</span></span>
<span class='r-in'>    <span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>h<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rle.html'>rle</a></span><span class='op'>(</span><span class='va'>simu</span><span class='op'>$</span><span class='va'>Z</span><span class='op'>)</span><span class='op'>$</span><span class='va'>lengths</span><span class='op'>)</span><span class='op'>[</span><span class='va'>k</span><span class='op'>]</span><span class='op'>+</span><span class='fl'>0.5</span>,lty<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span></span>
<span class='r-in'>    <span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>v<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/cumsum.html'>cumsum</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rle.html'>rle</a></span><span class='op'>(</span><span class='va'>simu</span><span class='op'>$</span><span class='va'>Z</span><span class='op'>)</span><span class='op'>$</span><span class='va'>lengths</span><span class='op'>)</span><span class='op'>[</span><span class='va'>k</span><span class='op'>]</span><span class='op'>+</span><span class='fl'>0.5</span>,lty<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='op'>}</span></span>
<span class='r-in'>  <span class='co'>#heatmap(z2comat(bmf.cb$c.lowervert),col=hmcols)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='co'>#</span></span>
<span class='r-in'>  <span class='co'># summarize Q (first need to transpose it)</span></span>
<span class='r-in'>  <span class='co'>#</span></span>
<span class='r-in'>  <span class='co'># Approach 1: compute the error |QQ' - E[QQ'|Y]|_Frobneious</span></span>
<span class='r-in'>  <span class='co'># Approach 2: compute the marginal co-activation probability</span></span>
<span class='r-in'>  <span class='co'>#             P(\sum_m Q_ml &gt;= 1, \sum_m Q_ml' &gt;= 1) -</span></span>
<span class='r-in'>  <span class='co'>#             This is invariant to the relabeling of latent states, or cluster labels.</span></span>
<span class='r-in'>  <span class='va'>nsamp_Q</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span><span class='op'>(</span><span class='va'>out</span><span class='op'>$</span><span class='va'>Q_merge_samp</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span></span>
<span class='r-in'>  <span class='va'>EQQ</span>     <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fl'>0</span>,nrow<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span><span class='op'>(</span><span class='va'>out</span><span class='op'>$</span><span class='va'>Q_merge_samp</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span>,</span>
<span class='r-in'>                    ncol<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span><span class='op'>(</span><span class='va'>out</span><span class='op'>$</span><span class='va'>Q_merge_samp</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span> <span class='co'># L by L.</span></span>
<span class='r-in'>  <span class='va'>EQQ_binary</span> <span class='op'>&lt;-</span> <span class='va'>EQQ</span></span>
<span class='r-in'>  <span class='co'># Approach 1:</span></span>
<span class='r-in'>  <span class='kw'>for</span> <span class='op'>(</span><span class='va'>iter</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='va'>nsamp_Q</span><span class='op'>)</span><span class='op'>{</span></span>
<span class='r-in'>    <span class='va'>A</span>   <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='va'>out</span><span class='op'>$</span><span class='va'>Q_merge_samp</span><span class='op'>[</span>,,<span class='va'>iter</span><span class='op'>]</span><span class='op'>)</span></span>
<span class='r-in'>    <span class='va'>EQQ</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='va'>A</span><span class='op'><a href='https://rdrr.io/r/base/matmult.html'>%*%</a></span><span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='va'>A</span><span class='op'>)</span><span class='op'>+</span><span class='va'>EQQ</span><span class='op'>*</span><span class='op'>(</span><span class='va'>iter</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span><span class='op'>/</span><span class='va'>iter</span> <span class='co'># invariant to the row reordering of Q.</span></span>
<span class='r-in'>    <span class='va'>EQQ_binary</span> <span class='op'>&lt;-</span> <span class='fl'>0</span><span class='op'>+</span><span class='op'>(</span><span class='va'>A</span><span class='op'><a href='https://rdrr.io/r/base/matmult.html'>%*%</a></span><span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='va'>A</span><span class='op'>)</span><span class='op'>&gt;</span><span class='fl'>0</span><span class='op'>)</span><span class='op'>+</span><span class='va'>EQQ_binary</span></span>
<span class='r-in'>  <span class='op'>}</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='co'># Approach 2:</span></span>
<span class='r-in'>  <span class='va'>EQQ_percent</span> <span class='op'>&lt;-</span> <span class='va'>EQQ_binary</span><span class='op'>/</span><span class='va'>nsamp_Q</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/graphics/image.html'>image</a></span><span class='op'>(</span><span class='va'>EQQ_percent</span>,col<span class='op'>=</span><span class='va'>hmcols</span>,main<span class='op'>=</span><span class='st'>"co-activation patterns across L dimensions"</span><span class='op'>)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='co'># Approach 1:</span></span>
<span class='r-in'>  <span class='va'>Q_Em</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='cn'>NA</span>,<span class='va'>nsamp_Q</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='kw'>for</span> <span class='op'>(</span><span class='va'>iter</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='va'>nsamp_Q</span><span class='op'>)</span><span class='op'>{</span></span>
<span class='r-in'>    <span class='va'>A</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='va'>out</span><span class='op'>$</span><span class='va'>Q_merge_samp</span><span class='op'>[</span>,,<span class='va'>iter</span><span class='op'>]</span><span class='op'>)</span></span>
<span class='r-in'>    <span class='va'>Q_Em</span><span class='op'>[</span><span class='va'>iter</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/norm.html'>norm</a></span><span class='op'>(</span><span class='va'>A</span><span class='op'><a href='https://rdrr.io/r/base/matmult.html'>%*%</a></span><span class='fu'><a href='https://rdrr.io/r/base/t.html'>t</a></span><span class='op'>(</span><span class='va'>A</span><span class='op'>)</span> <span class='op'>-</span> <span class='va'>EQQ</span>,<span class='st'>"F"</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='op'>}</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>Q_Em</span>,type<span class='op'>=</span><span class='st'>"o"</span>,main<span class='op'>=</span><span class='st'>"||QQ'-E[QQ'|Y]||"</span><span class='op'>)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='co'># choose the indices minimizing the errors:</span></span>
<span class='r-in'>  <span class='va'>ind_of_Q</span>       <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='va'>Q_Em</span><span class='op'>==</span><span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>min</a></span><span class='op'>(</span><span class='va'>Q_Em</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='co'>#</span></span>
<span class='r-in'>  <span class='co'># visualize truth:</span></span>
<span class='r-in'>  <span class='co'>#</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/grDevices/pdf.html'>pdf</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='st'>"inst/example_figure/"</span>,<span class='st'>"bmf_truth.pdf"</span><span class='op'>)</span>,width<span class='op'>=</span><span class='fl'>12</span>,height<span class='op'>=</span><span class='fl'>6</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='fu'><a href='plot_truth.html'>plot_truth</a></span><span class='op'>(</span><span class='va'>simu</span>,<span class='va'>options_sim0</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/grDevices/dev.html'>dev.off</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='co'>#</span></span>
<span class='r-in'>  <span class='co'># visualize the individual latent states depending on whether Q is known or not.</span></span>
<span class='r-in'>  <span class='co'>#</span></span>
<span class='r-in'>  <span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NULL.html'>is.null</a></span><span class='op'>(</span><span class='va'>model_options0</span><span class='op'>$</span><span class='va'>Q</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span> <span class='co'># &lt;--- Q known.</span></span>
<span class='r-in'>    <span class='va'>H_res</span>     <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fl'>0</span>,nrow<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>simu</span><span class='op'>$</span><span class='va'>datmat</span><span class='op'>)</span>,ncol<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>rowSums</a></span><span class='op'>(</span><span class='va'>model_options0</span><span class='op'>$</span><span class='va'>Q</span><span class='op'>)</span><span class='op'>!=</span><span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'>    <span class='va'>H_pat_res</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fl'>0</span>,nrow<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>simu</span><span class='op'>$</span><span class='va'>datmat</span><span class='op'>)</span>,ncol<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span><span class='op'>(</span><span class='va'>out</span><span class='op'>$</span><span class='va'>H_star_merge_samp</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span></span>
<span class='r-in'>    <span class='kw'>for</span> <span class='op'>(</span><span class='va'>l</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span><span class='op'>(</span><span class='va'>out</span><span class='op'>$</span><span class='va'>H_star_merge_samp</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span><span class='op'>{</span></span>
<span class='r-in'>      <span class='va'>tmp_mylist</span> <span class='op'>&lt;-</span> <span class='va'>out</span><span class='op'>$</span><span class='va'>mylist_samp</span><span class='op'>[</span>,<span class='va'>l</span><span class='op'>]</span></span>
<span class='r-in'>      <span class='va'>tmp0</span> <span class='op'>&lt;-</span> <span class='va'>out</span><span class='op'>$</span><span class='va'>H_star_samp</span><span class='op'>[</span><span class='va'>tmp_mylist</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/match.html'>match</a></span><span class='op'>(</span><span class='va'>out</span><span class='op'>$</span><span class='va'>z_samp</span><span class='op'>[</span>,<span class='va'>l</span><span class='op'>]</span>,<span class='va'>tmp_mylist</span><span class='op'>)</span><span class='op'>]</span>,,<span class='va'>l</span><span class='op'>]</span></span>
<span class='r-in'>      <span class='co'>#&lt;------ could be simpler!!!</span></span>
<span class='r-in'>      <span class='va'>tmp1</span> <span class='op'>&lt;-</span> <span class='va'>tmp0</span><span class='op'>[</span>,<span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>colSums</a></span><span class='op'>(</span><span class='va'>tmp0</span><span class='op'>)</span><span class='op'>!=</span><span class='fl'>0</span>,drop<span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>]</span></span>
<span class='r-in'>      <span class='va'>tmp</span> <span class='op'>&lt;-</span> <span class='va'>tmp1</span><span class='op'>[</span>,<span class='fu'><a href='order_mat_byrow.html'>order_mat_byrow</a></span><span class='op'>(</span><span class='va'>model_options0</span><span class='op'>$</span><span class='va'>Q</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>rowSums</a></span><span class='op'>(</span><span class='va'>model_options0</span><span class='op'>$</span><span class='va'>Q</span><span class='op'>)</span><span class='op'>!=</span><span class='fl'>0</span>,</span>
<span class='r-in'>                                                    ,drop<span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>]</span><span class='op'>)</span><span class='op'>$</span><span class='va'>ord</span>,drop<span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>]</span></span>
<span class='r-in'>      <span class='va'>H_pat_res</span><span class='op'>[</span>,<span class='va'>l</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='bin2dec_vec.html'>bin2dec_vec</a></span><span class='op'>(</span><span class='va'>tmp</span>,LOG<span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>)</span></span>
<span class='r-in'>      <span class='va'>H_res</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='va'>tmp</span> <span class='op'>+</span> <span class='va'>H_res</span><span class='op'>*</span><span class='op'>(</span><span class='va'>l</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span><span class='op'>/</span><span class='va'>l</span></span>
<span class='r-in'>    <span class='op'>}</span></span>
<span class='r-in'>    <span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span><span class='op'>(</span><span class='va'>H_pat_res</span>,<span class='fl'>1</span>,<span class='va'>table</span><span class='op'>)</span></span>
<span class='r-in'>    <span class='fu'><a href='https://rdrr.io/r/graphics/image.html'>image</a></span><span class='op'>(</span><span class='fu'><a href='f.html'>f</a></span><span class='op'>(</span><span class='va'>H_res</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='op'>}</span> <span class='kw'>else</span><span class='op'>{</span>   <span class='co'># &lt;---- Q unknown.</span></span>
<span class='r-in'>    <span class='co'>#</span></span>
<span class='r-in'>    <span class='co'># This is the best estimated Q:</span></span>
<span class='r-in'>    <span class='co'>#</span></span>
<span class='r-in'>    <span class='va'>Q_merged</span> <span class='op'>&lt;-</span> <span class='va'>out</span><span class='op'>$</span><span class='va'>Q_merge_samp</span><span class='op'>[</span>,,<span class='va'>ind_of_Q</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span> <span class='co'># just picked one.</span></span>
<span class='r-in'>    <span class='va'>NROW_Q_PLOT</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>Q_merged</span><span class='op'>)</span> <span class='co'># sum(rowSums(Q_merged)!=0)</span></span>
<span class='r-in'>    <span class='va'>Q_PLOT</span> <span class='op'>&lt;-</span> <span class='fu'><a href='f.html'>f</a></span><span class='op'>(</span><span class='fu'><a href='order_mat_byrow.html'>order_mat_byrow</a></span><span class='op'>(</span><span class='va'>Q_merged</span><span class='op'>)</span><span class='op'>$</span><span class='va'>res</span><span class='op'>)</span> <span class='co'># t(Q_merged)</span></span>
<span class='r-in'>    <span class='co'>#f(order_mat_byrow(Q_merged[rowSums(Q_merged)!=0,,drop=FALSE])$res)</span></span>
<span class='r-in'>    <span class='fu'><a href='https://rdrr.io/r/graphics/image.html'>image</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span><span class='op'>(</span><span class='va'>simu</span><span class='op'>$</span><span class='va'>datmat</span><span class='op'>)</span>,<span class='fl'>1</span><span class='op'>:</span><span class='va'>NROW_Q_PLOT</span>,</span>
<span class='r-in'>          <span class='va'>Q_PLOT</span>,</span>
<span class='r-in'>          main<span class='op'>=</span><span class='st'>"Best Q (merged &amp; ordered)"</span>,col<span class='op'>=</span><span class='va'>hmcols</span>,</span>
<span class='r-in'>          xlab<span class='op'>=</span><span class='st'>"Dimension (1:L)"</span>,</span>
<span class='r-in'>          ylab<span class='op'>=</span><span class='st'>"Latent State (1:M)"</span>,yaxt<span class='op'>=</span><span class='st'>"n"</span>,cex.lab<span class='op'>=</span><span class='fl'>1.2</span><span class='op'>)</span></span>
<span class='r-in'>    <span class='kw'>for</span> <span class='op'>(</span><span class='va'>k</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='va'>NROW_Q_PLOT</span><span class='op'>)</span><span class='op'>{</span></span>
<span class='r-in'>      <span class='fu'><a href='https://rdrr.io/r/graphics/abline.html'>abline</a></span><span class='op'>(</span>h<span class='op'>=</span><span class='va'>NROW_Q_PLOT</span><span class='op'>-</span><span class='va'>k</span><span class='op'>+</span><span class='fl'>0.5</span>,</span>
<span class='r-in'>             lty<span class='op'>=</span><span class='fl'>2</span>,col<span class='op'>=</span><span class='st'>"grey"</span>,lwd<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span></span>
<span class='r-in'>    <span class='op'>}</span></span>
<span class='r-in'>    </span>
<span class='r-in'>    <span class='co'>#</span></span>
<span class='r-in'>    <span class='co'># Summarize H* and H*(Z) for individual predictions:</span></span>
<span class='r-in'>    <span class='co'>#</span></span>
<span class='r-in'>    <span class='co'># If we compare it to H, then the clustering matters too, not</span></span>
<span class='r-in'>    <span class='co'># just H^*.</span></span>
<span class='r-in'>    <span class='co'>#</span></span>
<span class='r-in'>    <span class='co'># Approach: just obtain the H samples from those iterations with the best Q</span></span>
<span class='r-in'>    <span class='co'>#            obtained above.</span></span>
<span class='r-in'>    <span class='co'>#</span></span>
<span class='r-in'>    <span class='va'>H_res</span>     <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fl'>0</span>,nrow<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>simu</span><span class='op'>$</span><span class='va'>datmat</span><span class='op'>)</span>,ncol<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>rowSums</a></span><span class='op'>(</span><span class='va'>Q_merged</span><span class='op'>)</span><span class='op'>!=</span><span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'>    <span class='va'>H_pat_res</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span><span class='op'>(</span><span class='fl'>0</span>,nrow<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>simu</span><span class='op'>$</span><span class='va'>datmat</span><span class='op'>)</span>,ncol<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>ind_of_Q</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'>    <span class='co'># columns for the best indices.</span></span>
<span class='r-in'>    <span class='co'># here ind_of_Q are those that minimized the Q loss.</span></span>
<span class='r-in'>    <span class='kw'>for</span> <span class='op'>(</span><span class='va'>l</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_along</a></span><span class='op'>(</span><span class='va'>ind_of_Q</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span></span>
<span class='r-in'>      <span class='va'>tmp_mylist</span> <span class='op'>&lt;-</span> <span class='va'>out</span><span class='op'>$</span><span class='va'>mylist_samp</span><span class='op'>[</span>,<span class='va'>ind_of_Q</span><span class='op'>[</span><span class='va'>l</span><span class='op'>]</span><span class='op'>]</span></span>
<span class='r-in'>      <span class='va'>tmp0</span> <span class='op'>&lt;-</span> <span class='va'>out</span><span class='op'>$</span><span class='va'>col_merged_H_star_samp</span><span class='op'>[</span><span class='va'>out</span><span class='op'>$</span><span class='va'>z_samp</span><span class='op'>[</span>,<span class='va'>ind_of_Q</span><span class='op'>[</span><span class='va'>l</span><span class='op'>]</span><span class='op'>]</span>,,<span class='va'>ind_of_Q</span><span class='op'>[</span><span class='va'>l</span><span class='op'>]</span><span class='op'>]</span></span>
<span class='r-in'>      <span class='va'>tmp1</span> <span class='op'>&lt;-</span> <span class='va'>tmp0</span><span class='op'>[</span>,<span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>colSums</a></span><span class='op'>(</span><span class='va'>tmp0</span><span class='op'>)</span><span class='op'>!=</span><span class='fl'>0</span>,drop<span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>]</span></span>
<span class='r-in'>      <span class='va'>tmp</span> <span class='op'>&lt;-</span> <span class='va'>tmp1</span><span class='op'>[</span>,<span class='fu'><a href='order_mat_byrow.html'>order_mat_byrow</a></span><span class='op'>(</span><span class='va'>Q_merged</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>rowSums</a></span><span class='op'>(</span><span class='va'>Q_merged</span><span class='op'>)</span><span class='op'>!=</span><span class='fl'>0</span>,,</span>
<span class='r-in'>                                            drop<span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>]</span><span class='op'>)</span><span class='op'>$</span><span class='va'>ord</span>,drop<span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>]</span></span>
<span class='r-in'>      <span class='va'>H_pat_res</span><span class='op'>[</span>,<span class='va'>l</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='bin2dec_vec.html'>bin2dec_vec</a></span><span class='op'>(</span><span class='va'>tmp</span>,LOG<span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>)</span></span>
<span class='r-in'>      <span class='va'>H_res</span> <span class='op'>&lt;-</span> <span class='op'>(</span><span class='va'>tmp</span> <span class='op'>+</span> <span class='va'>H_res</span><span class='op'>*</span><span class='op'>(</span><span class='va'>l</span><span class='op'>-</span><span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span><span class='op'>/</span><span class='va'>l</span></span>
<span class='r-in'>    <span class='op'>}</span></span>
<span class='r-in'>    <span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span><span class='op'>(</span><span class='va'>H_pat_res</span>,<span class='fl'>1</span>,<span class='va'>table</span><span class='op'>)</span></span>
<span class='r-in'>    <span class='fu'><a href='https://rdrr.io/r/grDevices/pdf.html'>pdf</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='st'>"inst/example_figure/"</span>,</span>
<span class='r-in'>                  <span class='st'>"H_estimated_marginal_prob_vs_truth.pdf"</span><span class='op'>)</span>,width<span class='op'>=</span><span class='fl'>12</span>,height<span class='op'>=</span><span class='fl'>6</span><span class='op'>)</span></span>
<span class='r-in'>    <span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span>mfrow<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'>    <span class='fu'><a href='https://rdrr.io/r/graphics/image.html'>image</a></span><span class='op'>(</span><span class='fu'><a href='f.html'>f</a></span><span class='op'>(</span><span class='va'>H_res</span><span class='op'>)</span>,col<span class='op'>=</span><span class='va'>hmcols</span>,main<span class='op'>=</span><span class='st'>"estimated marginal prob"</span><span class='op'>)</span> <span class='co'># &lt;--- get marg prob.</span></span>
<span class='r-in'>    <span class='fu'><a href='https://rdrr.io/r/graphics/image.html'>image</a></span><span class='op'>(</span><span class='fu'><a href='f.html'>f</a></span><span class='op'>(</span><span class='va'>simu</span><span class='op'>$</span><span class='va'>Eta</span><span class='op'>[</span>,<span class='fu'><a href='order_mat_byrow.html'>order_mat_byrow</a></span><span class='op'>(</span><span class='va'>simu</span><span class='op'>$</span><span class='va'>Q</span><span class='op'>)</span><span class='op'>$</span><span class='va'>ord</span><span class='op'>]</span><span class='op'>)</span>,col<span class='op'>=</span><span class='va'>hmcols</span>,main<span class='op'>=</span><span class='st'>"truth"</span><span class='op'>)</span></span>
<span class='r-in'>    <span class='fu'><a href='https://rdrr.io/r/grDevices/dev.html'>dev.off</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span class='r-in'>    <span class='co'># issues: the order of the rows of Q at ind_of_Q might be different, so need to order them.</span></span>
<span class='r-in'>  <span class='op'>}</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='co'># posterior distribution over the number of pseudo-clusters T: &lt;-- scientific clusters?</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>out</span><span class='op'>$</span><span class='va'>t_samp</span>,type<span class='op'>=</span><span class='st'>"l"</span>,ylab<span class='op'>=</span><span class='st'>"T: #pseudo-clusters"</span><span class='op'>)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='co'>## individual predictions:</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/grDevices/pdf.html'>pdf</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='st'>"inst/example_figure/"</span>,<span class='st'>"individual_pred_simulation.pdf"</span><span class='op'>)</span>,height<span class='op'>=</span><span class='fl'>15</span>,width<span class='op'>=</span><span class='fl'>12</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span>mar<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>,<span class='fl'>8</span>,<span class='fl'>8</span>,<span class='fl'>0</span><span class='op'>)</span>,mfrow<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>,<span class='fl'>1</span><span class='op'>)</span>,oma<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>5</span>,<span class='fl'>5</span>,<span class='fl'>5</span>,<span class='fl'>5</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>simu_dat</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span></span>
<span class='r-in'>    <span class='fu'><a href='plot_individual_pred.html'>plot_individual_pred</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span><span class='op'>(</span><span class='va'>H_pat_res</span>,<span class='fl'>1</span>,<span class='va'>table</span><span class='op'>)</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span><span class='op'>/</span><span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span><span class='op'>(</span><span class='va'>H_pat_res</span>,<span class='fl'>1</span>,<span class='va'>table</span><span class='op'>)</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span>,</span>
<span class='r-in'>                         <span class='fl'>1</span><span class='op'>:</span><span class='va'>model_options0</span><span class='op'>$</span><span class='va'>m_max</span>,<span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"Obs "</span>, <span class='va'>i</span><span class='op'>)</span>,asp<span class='op'>=</span><span class='fl'>0.5</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='op'>}</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/grDevices/dev.html'>dev.off</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='co'># check positive rate estimates:</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/grDevices/pdf.html'>pdf</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='st'>"inst/example_figure/"</span>,<span class='st'>"check_PR_post_vs_prior.pdf"</span><span class='op'>)</span>,width<span class='op'>=</span><span class='fl'>12</span>,height<span class='op'>=</span><span class='fl'>6</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span>mfrow<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>5</span>,<span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='kw'>for</span> <span class='op'>(</span><span class='va'>l</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='va'>L0</span><span class='op'>)</span><span class='op'>{</span></span>
<span class='r-in'>    <span class='fu'><a href='https://rdrr.io/r/graphics/par.html'>par</a></span><span class='op'>(</span>mar<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>1</span>,<span class='fl'>1</span>,<span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'>    <span class='fu'>baker</span><span class='fu'>::</span><span class='fu'>beta_plot</span><span class='op'>(</span><span class='va'>model_options0</span><span class='op'>$</span><span class='va'>a_psi</span><span class='op'>[</span><span class='fl'>1</span>,<span class='va'>l</span><span class='op'>]</span>,<span class='va'>model_options0</span><span class='op'>$</span><span class='va'>a_psi</span><span class='op'>[</span><span class='fl'>2</span>,<span class='va'>l</span><span class='op'>]</span><span class='op'>)</span></span>
<span class='r-in'>    <span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>out</span><span class='op'>$</span><span class='va'>psi_samp</span><span class='op'>[</span><span class='va'>l</span>,<span class='op'>]</span>,add<span class='op'>=</span><span class='cn'>TRUE</span>,freq<span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>)</span></span>
<span class='r-in'>    <span class='fu'><a href='https://rdrr.io/r/graphics/legend.html'>legend</a></span><span class='op'>(</span><span class='st'>"topright"</span>,legend <span class='op'>=</span> <span class='va'>l</span><span class='op'>)</span></span>
<span class='r-in'>    <span class='fu'>baker</span><span class='fu'>::</span><span class='fu'>beta_plot</span><span class='op'>(</span><span class='va'>model_options0</span><span class='op'>$</span><span class='va'>a_theta</span><span class='op'>[</span><span class='fl'>1</span>,<span class='va'>l</span><span class='op'>]</span>,<span class='va'>model_options0</span><span class='op'>$</span><span class='va'>a_theta</span><span class='op'>[</span><span class='fl'>2</span>,<span class='va'>l</span><span class='op'>]</span><span class='op'>)</span></span>
<span class='r-in'>    <span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span><span class='op'>(</span><span class='va'>out</span><span class='op'>$</span><span class='va'>theta_samp</span><span class='op'>[</span><span class='va'>l</span>,<span class='op'>]</span>,add<span class='op'>=</span><span class='cn'>TRUE</span>,freq<span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='op'>}</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/grDevices/dev.html'>dev.off</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/grDevices/pdf.html'>pdf</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='st'>"inst/example_figure/"</span>,<span class='st'>"posterior_sci_cluster_number.pdf"</span><span class='op'>)</span>,</span>
<span class='r-in'>      width<span class='op'>=</span><span class='fl'>10</span>,height<span class='op'>=</span><span class='fl'>6</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='fu'><a href='scatterhist.html'>scatterhist</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span><span class='op'>(</span><span class='va'>out</span><span class='op'>$</span><span class='va'>z_sci_samp</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span><span class='op'>(</span><span class='va'>out</span><span class='op'>$</span><span class='va'>z_sci_samp</span>,<span class='fl'>2</span>,</span>
<span class='r-in'>                                           <span class='kw'>function</span><span class='op'>(</span><span class='va'>v</span><span class='op'>)</span><span class='op'>{</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='va'>v</span><span class='op'>)</span><span class='op'>)</span><span class='op'>}</span><span class='op'>)</span>,</span>
<span class='r-in'>              <span class='st'>"Index"</span>,<span class='st'>"tilde{T}: #scientific clusters"</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/grDevices/dev.html'>dev.off</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='co'># posterior distribution of active/effective dimensions (machines):</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/grDevices/pdf.html'>pdf</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/file.path.html'>file.path</a></span><span class='op'>(</span><span class='st'>"inst/example_figure/"</span>,<span class='st'>"posterior_effective_machines_number.pdf"</span><span class='op'>)</span>,</span>
<span class='r-in'>      width<span class='op'>=</span><span class='fl'>10</span>,height<span class='op'>=</span><span class='fl'>6</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span><span class='op'>(</span><span class='va'>out</span><span class='op'>$</span><span class='va'>col_merged_H_star_samp</span>,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span><span class='op'>)</span>,</span>
<span class='r-in'>                   <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colSums.html'>colSums</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>&gt;</span><span class='fl'>0</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>/</span><span class='va'>mcmc_options0</span><span class='op'>$</span><span class='va'>n_keep</span>,</span>
<span class='r-in'>       xlab <span class='op'>=</span> <span class='st'>"Effect Number of Machines"</span>,xlim<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='va'>model_options0</span><span class='op'>$</span><span class='va'>m_max</span><span class='op'>)</span>,</span>
<span class='r-in'>       ylab <span class='op'>=</span><span class='st'>"Posterior Probability"</span>,</span>
<span class='r-in'>       main<span class='op'>=</span><span class='st'>""</span>,lwd<span class='op'>=</span><span class='fl'>4</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/grDevices/dev.html'>dev.off</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/graphics/image.html'>image</a></span><span class='op'>(</span><span class='fu'><a href='f.html'>f</a></span><span class='op'>(</span><span class='va'>simu</span><span class='op'>$</span><span class='va'>Q</span><span class='op'>)</span>,col<span class='op'>=</span><span class='va'>hmcols</span><span class='op'>)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/graphics/image.html'>image</a></span><span class='op'>(</span><span class='fu'><a href='f.html'>f</a></span><span class='op'>(</span><span class='va'>simu</span><span class='op'>$</span><span class='va'>xi</span><span class='op'>)</span>,col<span class='op'>=</span><span class='va'>hmcols</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='va'>pred_xi</span> <span class='op'>&lt;-</span> <span class='fl'>0</span><span class='op'>+</span><span class='op'>(</span><span class='va'>out</span><span class='op'>$</span><span class='va'>H_star_samp</span><span class='op'>[</span><span class='va'>out</span><span class='op'>$</span><span class='va'>z_samp</span><span class='op'>[</span>,<span class='va'>ind_dahl</span><span class='op'>]</span>,,<span class='va'>ind_dahl</span><span class='op'>]</span><span class='op'><a href='https://rdrr.io/r/base/matmult.html'>%*%</a></span></span>
<span class='r-in'>                  <span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span><span class='op'>(</span><span class='va'>out</span><span class='op'>$</span><span class='va'>Q_samp</span><span class='op'>[</span>,,<span class='va'>ind_dahl</span><span class='op'>]</span>,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>2</span><span class='op'>)</span>,<span class='va'>mean</span><span class='op'>)</span><span class='op'>)</span><span class='op'>&gt;</span><span class='fl'>0.5</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/graphics/image.html'>image</a></span><span class='op'>(</span><span class='fu'><a href='f.html'>f</a></span><span class='op'>(</span><span class='va'>pred_xi</span><span class='op'>)</span>,col<span class='op'>=</span><span class='va'>hmcols</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='fu'><a href='https://rdrr.io/r/graphics/image.html'>image</a></span><span class='op'>(</span><span class='fu'><a href='f.html'>f</a></span><span class='op'>(</span><span class='va'>pred_xi</span><span class='op'>-</span> <span class='va'>simu</span><span class='op'>$</span><span class='va'>xi</span><span class='op'>)</span>,col<span class='op'>=</span><span class='va'>hmcols</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'>  </span>
<span class='r-in'>  </span>
<span class='r-in'><span class='op'>}</span> <span class='co'># END OF DONT RUN.</span></span>
<span class='r-in'></span>
<span class='r-in'></span>
<span class='r-in'></span>
<span class='r-in'></span>
</code></pre></div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p><p>Developed by Zhenke Wu, Scott Zeger.</p></p>
</div>

<div class="pkgdown">
  <p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.6.1.9001.</p></p>
</div>

      </footer>
   </div>

  


  

  </body>
</html>


